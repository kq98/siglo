#!@PYTHON@


import os
import sys
import signal
import gettext
import argparse
import dbus

from dbus.mainloop.glib import DBusGMainLoop

import gi
from gi.repository import Gio,GLib

VERSION = '@VERSION@'
pkgdatadir = '@pkgdatadir@'
localedir = '@localedir@'

sys.path.insert(1, pkgdatadir)
signal.signal(signal.SIGINT, signal.SIG_DFL)
gettext.install('siglo', localedir)

def main():
    p = argparse.ArgumentParser(description="app to sync InfiniTime watch")
    p.add_argument('--hidden', required=False, action='store_true', help="Hide window at startup")
    args = p.parse_args()
    
    from siglo import config
    config = config.config()
    config.load_defaults()

    resource = Gio.Resource.load(os.path.join(pkgdatadir, 'siglo.gresource'))
    resource._register()

    #check if a Siglo instance is already running
    DBusGMainLoop(set_as_default=True)
    bus = dbus.SessionBus()
    try:
        win_obj = bus.get_object('com.github.alexr4535.siglo','/com/github/alexr4535/siglo/window/1')
        action_iface = dbus.Interface(win_obj, dbus_interface="org.gtk.Actions")
        action_iface.Activate("show",[],{})
        sys.exit(0)
    except Exception as e:
        pass

    from siglo import main
    sys.exit(main.main(VERSION, args.hidden))

if __name__ == '__main__':
    main()


